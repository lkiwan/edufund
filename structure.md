# Project Structure and Functions

This document lists each significant file and explains its functions and responsibilities in detail.

## Root
- `server.js`
  - Initializes Express app, enables CORS and JSON parsing, serves static build.
  - Wires SQLite via `src/db/init-db.js` and auth helpers via `src/services/authService.js`.
  - API Endpoints:
    - `POST /api/auth/login`: Validates credentials using bcrypt; returns user without password.
    - `POST /api/auth/register`: Hashes password, inserts user, returns created user without password.
    - `POST /api/campaigns`: Creates a campaign; inserts row into `campaigns`, initializes metrics in `campaign_metrics`.
    - `GET /api/campaigns`: Lists campaigns with search/sort/pagination; maps DB fields to UI shape and returns `{ campaigns, hasMore, total }`.
    - `GET /api/campaigns/:id`: Returns a single campaign with metrics and student info when present.
    - `GET /api/campaigns/:id/donations`: Lists donations for a campaign; returns `{ donations: [...] }` in UI-friendly format.
    - `POST /api/donations`: Creates a donation and increments campaign `current_amount`.
    - `GET /api/campaigns/:id/updates`: Returns campaign updates joined with author email.
    - `POST /api/campaigns/:id/updates`: Inserts a new update; bumps `updates_posted` and `last_updated` in metrics.
    - `GET /api/campaigns/:id/comments`: Returns campaign comments ordered by `created_at`.
    - `POST /api/campaigns/:id/comments`: Inserts a new comment (optionally with `userId`/`authorName`).
    - `POST /api/campaigns/:id/favorite`: Adds or removes a favorite depending on `action`; requires `userId`.
    - `GET /api/users/:id/favorites`: Lists favorited campaigns for a user.
    - `POST /api/campaigns/:id/view`: Increments `view_count` in `campaign_metrics`.
    - `POST /api/campaigns/:id/share`: Increments `share_count` in `campaign_metrics`.
    - `GET /api/analytics/campaign/:id`: Returns totals and metrics for a campaign.
    - `GET /api/analytics/student/:userId`: Uses `verifyToken` middleware; aggregates totals across student campaigns.
  - Catch-all route serves `build/index.html` for non-API paths.
  - Starts server on `PORT` (default `3001`).

- `package.json`
  - Scripts: `start` (Vite dev), `build` (production build), `serve` (preview build).
  - Declares dependencies for React, Express, SQLite, Tailwind, etc.

- `vite.config.mjs`
  - Configures Vite dev server and dev proxy: forwards `/api/*` to `http://localhost:3001`.

- `.env`
  - Environment variables (if present). Not used directly in code shown.

- `README.md`
  - Project overview, setup, API endpoints, database schema, GoFundMe-like feature notes.

## Scripts
- `scripts/migrate-and-seed.js`
  - Ensures base tables exist (`campaigns`, `campaign_metrics`).
  - Adds missing columns on `campaigns` if needed via `PRAGMA table_info`.
  - Seeds 6 sample campaigns and initializes metrics for each.

- `scripts/seed-campaigns.js`
  - Legacy seeding utility that inserts sample campaigns when table is empty.

- `scripts/collect-images.js`
  - Utility to collect images into a manifest (used by build/static assets pipeline).

## Public and Build
- `public/`
  - Static assets for dev: `favicon.ico`, PWA `manifest.json`, `robots.txt`, `_redirects` for SPA routing.
- `build/`
  - Production output generated by `npm run build`.

## Source (`src/`)

### App Entrypoints
- `src/index.jsx`
  - React app bootstrap; renders `<App />` into the DOM.
- `src/App.jsx`
  - Top-level app component; often includes layout wrappers.
- `src/Routes.jsx`
  - React Router setup with routes:
    - `/` and `/campaign-discovery` → Campaign discovery page.
    - `/campaign-details` → Campaign details page.
    - `/student-dashboard` (+ `create`, `profile`, `documents`, `analytics`) → Student dashboard.
    - `/donor-dashboard` → Donor dashboard.
    - `/admin-dashboard` → Admin dashboard.
    - `/login-register` → Login/Register page.
    - `*` → NotFound page.
  - Wraps routes with `ErrorBoundary` and `ScrollToTop`.

### Database
- `src/db/init-db.js`
  - Creates/opens SQLite database `edufund.sqlite`.
  - Enables foreign keys; ensures directory exists.
  - Tables:
    - `users`: `id`, `email` (unique), `password` (bcrypt), `role`, `created_at`; seeds admin user (`omar@gmail.com`).
    - `campaigns` (base and migrations): core fields plus forward-compatible columns `user_id`, `featured`, `student_name`, `student_avatar`, `student_university`, `student_field`, `student_year`.
    - `donations`: donation details including optional `user_id`, `is_anonymous`, `amount`, `status`, `created_at`.
    - `campaign_metrics`: aggregated counters `view_count`, `share_count`, `updates_posted`, `last_updated`.
    - `campaign_updates`: posts with `title`, `content`, optional `image_url`, author `user_id`.
    - `campaign_comments`: comments with optional `author_name` and `user_id`.
    - `favorites`: unique `(user_id, campaign_id)` with `created_at`.
  - Exports the `db` connection for server use.

### Services
- `src/services/authService.js`
  - `login(email, password)`: Fetches user by email; verifies bcrypt hash; returns user without password on success.
  - `register(email, password, role='user')`: Checks for existing email; hashes password; inserts user; returns created user without password.
  - `getUserById(id)`: Returns user object without password.
  - `verifyToken(req, res, next)`: Lightweight middleware; attaches `req.user` using `:userId` route param for protected routes.

- `src/services/dbService.js`
  - Server-side guard to ensure DB is initialized via `init-db.js`; logs to console on client side.

### Components
- `src/components/ErrorBoundary.jsx`
  - Catches runtime errors in React tree; renders fallback UI.
- `src/components/ScrollToTop.jsx`
  - Restores scroll to top on route changes.
- `src/components/AppIcon.jsx`, `AppImage.jsx`
  - Helper components for rendering icons and images consistently.
- `src/components/ui/*`
  - Reusable UI primitives (Button, Input, Select, Checkbox, modals, navigation, etc.) used across pages.

### Pages
- `src/pages/NotFound.jsx`
  - Fallback page rendered for unknown routes.

- `src/pages/campaign-discovery/index.jsx`
  - Fetches campaigns from `/api/campaigns` with filters, sorting, pagination; displays cards.
  - Manages `filters`, `page`, `hasMore`, error states; shows auth modal for actions requiring authentication.

- `src/pages/campaign-details/index.jsx`
  - Loads a single campaign via `/api/campaigns/:id`.
  - Fetches donations via `/api/campaigns/:id/donations` and updates via `/api/campaigns/:id/updates`.
  - Displays campaign story, progress, donors, updates, and student info when available.

- `src/pages/student-dashboard/index.jsx`
  - Student dashboard UI: quick stats, recent activity, navigation to sub-sections.
  - Integrates with navigation and language selection; prepared for analytics and campaign management.

- `src/pages/student-dashboard/components/*`
  - `CampaignManagement.jsx`: UI to view/edit campaign info, performance metrics, quick actions.
  - Additional components for analytics and settings scaffolding.

- `src/pages/donor-dashboard/index.jsx`
  - Donor dashboard UI: quick actions, discover campaigns, profile and receipts placeholders.
  - Handles authentication via modal and role storage.

- `src/pages/admin-dashboard/*`
  - Admin dashboard components for system settings, financial reporting, health checks, etc.
  - `components/SystemSettings.jsx`: Comprehensive settings UI with multilingual labels.
  - `components/FinancialReporting.jsx`: Visualizes donation trends and recent transactions.

- `src/pages/login-register/index.jsx`
  - Login/Register page wrapper that toggles modes and language.
  - `components/AuthForm.jsx`: Handles form validation, mock auth flow, and role-based navigation.

### Styles
- `src/styles/index.css`, `tailwind.css`
  - Tailwind base and project-specific CSS. Tailwind is configured via `tailwind.config.js`.

### Utilities
- `src/utils/cn.js`
  - Classname utility helper for composing conditional class names.

### Config
- `tailwind.config.js`
  - TailwindCSS configuration.
- `jsconfig.json`
  - Compiler options with `baseUrl` set to `./src` for absolute imports.
- `index.html`
  - HTML template used by Vite in development.

---

## Data Flow Summary
- Frontend calls relative `/api/*` endpoints; Vite dev proxy forwards to Express on `http://localhost:3001`.
- Express handlers in `server.js` interact with SQLite via `init-db.js`.
- Auth uses bcrypt for hash/compare and simple middleware for protected routes.
- Campaign lifecycle covers creation, discovery listing, details view, donations, updates, comments, favorites, and analytics.